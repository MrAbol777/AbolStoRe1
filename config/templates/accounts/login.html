{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}ورود به حساب کاربری - Abol Store{% endblock %}

{% block content %}
<div class="max-w-md mx-auto bg-white p-6 rounded-lg shadow-md">
    <h1 class="text-2xl font-bold text-secondary mb-6 text-center">ورود به حساب کاربری</h1>
    
    <form id="login-form" method="post" class="space-y-4">
        {% csrf_token %}
        {{ form|crispy }}
        
        {% if next %}
            <input type="hidden" name="next" value="{{ next }}">
        {% endif %}
        
        <div id="login-errors" class="text-red-600 text-sm space-y-1"></div>
        
        <div class="flex justify-between items-center mt-6">
            <button id="login-submit" type="submit" class="bg-primary text-white px-6 py-2 rounded-md hover:bg-primary-dark transition flex items-center gap-2">
                <span>ورود</span>
                <span id="login-spinner" class="hidden w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></span>
            </button>
            <a href="{% url 'accounts:register' %}" class="text-secondary hover:underline">ثبت‌نام نکرده‌اید؟</a>
        </div>
    </form>
</div>

{% endblock %}

{% block extra_js %}
<script>
// اعتبارسنجی ساده سمت‌کلاینت برای ورود
const form = document.getElementById('login-form');
const errorsBox = document.getElementById('login-errors');
const submitBtn = document.getElementById('login-submit');
const spinner = document.getElementById('login-spinner');

form.addEventListener('submit', function(e) {
    errorsBox.innerHTML = '';
    const usernameInput = form.querySelector('input[name="username"]');
    const passwordInput = form.querySelector('input[name="password"]');
    let hasError = false;
    
    if (usernameInput && usernameInput.value.trim().length === 0) {
        errorsBox.insertAdjacentHTML('beforeend', '<div>نام کاربری را وارد کنید.</div>');
        hasError = true;
    }
    if (passwordInput && passwordInput.value.length < 8) {
        errorsBox.insertAdjacentHTML('beforeend', '<div>رمز عبور باید حداقل ۸ کاراکتر باشد.</div>');
        hasError = true;
    }
    
    if (hasError) {
        e.preventDefault();
        return;
    }
    // نمایش اسپینر
    spinner.classList.remove('hidden');
    submitBtn.setAttribute('disabled', 'disabled');
});
</script>
{% endblock %}