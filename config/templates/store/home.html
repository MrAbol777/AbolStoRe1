{% extends 'base.html' %}
{% load humanize %}

{% block title %}آبول استور - فروشگاه کمبوهای گیمینگ{% endblock %}

{% block content %}
<section class="container mx-auto px-4 py-8" role="main">
    <div class="relative overflow-hidden py-20 md:py-32 text-white text-center dark:bg-glossy-black
                before:content-[''] before:absolute before:inset-0 before:bg-gradient-to-b from-accent-orange/20 to-transparent
                before:opacity-70 before:blur-3xl before:z-0 animate-fade-in-down animation-delay-300">
        <header class="relative z-10 mb-10">
            <h1 class="text-5xl md:text-6xl font-light mb-4 drop-shadow-lg">به ابول استور خوش آمدید</h1>
            <p class="text-xl md:text-2xl font-light opacity-90">بهترین کمبوهای گیمینگ با تضمین اصالت</p>
        </header>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for product in products %}
        <a href="{% url 'product_detail' product.pk %}"
          class="group relative transform overflow-hidden rounded-3xl bg-dark-navy shadow-lg transition-all duration-300 hover:scale-[1.02] hover:shadow-orange-glow animate-fade-in-up animation-delay-{{ forloop.counter0 }}00"
        >
          <div class="relative h-56 w-full overflow-hidden rounded-2xl">
                <figure class="relative z-10">
                    {% if product.image %}
                        <picture>
                            {% if product.webp_image %}
                                <source srcset="{{ product.webp_image.url }}" type="image/webp">
                            {% endif %}
                            <img src="{{ product.image.url }}" alt="{{ product.name }}" class="w-full h-48 object-cover" itemprop="image" onerror="this.onerror=null;this.src='/static/images/logo.svg';" loading="lazy" decoding="async">
                        </picture>
                    {% else %}
                        <div class="w-full h-48 bg-gray-200 flex items-center justify-center">
                            <span class="text-gray-500">بدون تصویر</span>
                        </div>
                    {% endif %}
                </figure>
                
                <div class="p-4 relative z-10">
                    <h2 class="text-xl font-semibold text-white mb-2 text-shadow-md" itemprop="name">{{ product.name }}</h2>
                    
                    <div class="flex items-center mb-2">
                        <span class="text-sm font-medium {% if product.guarantee_type == 'metaK' %}bg-accent-orange/70{% else %}bg-blue-600/70{% endif %} dark:text-white px-2 py-1 rounded-full">
                            {{ product.get_guarantee_type_display }}
                        </span>
                        <span class="text-sm font-medium bg-green-600/70 dark:text-white px-2 py-1 rounded-full mr-2">
                            تضمین سوپرتاش
                        </span>
                    </div>
                    
                    <p class="text-gray-300 mb-4 line-clamp-2 text-shadow" itemprop="description">{{ product.description }}</p>
                    
                    <div class="flex justify-between items-center">
                        <span class="text-lg font-bold text-accent-orange" itemprop="offers" itemscope itemtype="http://schema.org/Offer">
                            <span itemprop="priceCurrency" content="IRR"></span>
                            <span itemprop="price">{{ product.price|floatformat:0|intcomma }}</span> تومان
                        </span>
                        <span class="text-sm text-gray-400">تعداد پارت: {{ product.stock }}</span>
                    </div>
                    
                    <footer class="mt-4">
                        <div class="block w-full bg-accent-orange/80 hover:bg-accent-orange text-white text-center py-2 rounded-md transition-colors duration-300 hover:scale-[1.03] shadow-orange-glow">
                            مشاهده و خرید
                        </div>
                    </footer>
                </div>
            </a>
        {% empty %}
            <div class="col-span-full text-center py-10">
                <p class="text-xl text-gray-500">در حال حاضر محصولی موجود نیست.</p>
            </div>
        {% endfor %}
    </div>
</section>
{% endblock %}